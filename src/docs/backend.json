{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Hesab Ketab application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
            "type": "string",
            "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "BankAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BankAccount",
      "type": "object",
      "description": "Represents a bank account, which can be personal or shared.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Owner of the account if personal. Null if shared." },
        "bankName": { "type": "string" },
        "accountNumber": { "type": "string" },
        "cardNumber": { "type": "string" },
        "expiryDate": { "type": "string", "pattern": "^(0[1-9]|1[0-2])\\/([0-9]{2})$", "description": "Expiry date in MM/YY format." },
        "cvv2": { "type": "string" },
        "accountType": { "type": "string", "enum": ["checking", "savings"], "description": "Type of the bank account." },
        "balance": { "type": "number" },
        "initialBalance": { "type": "number" },
        "blockedBalance": { "type": "number", "description": "Amount blocked for financial goals."},
        "isShared": { "type": "boolean" },
        "members": { "type": "object", "description": "Map of user IDs who are members of this shared account." },
        "theme": { "type": "string", "enum": ["blue", "green", "purple", "orange", "gray"] }
      },
      "required": ["id", "bankName", "accountNumber", "cardNumber", "expiryDate", "cvv2", "accountType", "balance", "initialBalance"]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents an income transaction.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The user account this income belongs to (owner of the bank account)." },
        "registeredByUserId": { "type": "string", "description": "The user who registered this transaction." },
        "bankAccountId": { "type": "string" },
        "amount": { "type": "number" },
        "date": { "type": "string", "format": "date-time" },
        "description": { "type": "string" },
        "source": { "type": "string" },
        "type": { "type": "string", "enum": ["income"] },
        "category": { "type": "string", "description": "Always 'درآمد'" },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "userId", "registeredByUserId", "bankAccountId", "amount", "date", "description", "source", "type", "category", "createdAt"]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense transaction.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The user account this expense belongs to (owner of the bank account)." },
        "registeredByUserId": { "type": "string", "description": "The user who registered this transaction." },
        "bankAccountId": { "type": "string" },
        "categoryId": { "type": "string" },
        "amount": { "type": "number" },
        "date": { "type": "string", "format": "date-time" },
        "description": { "type": "string" },
        "type": { "type": "string", "enum": ["expense"] },
        "checkId": { "type": "string" },
        "goalId": { "type": "string" },
        "loanPaymentId": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "userId", "registeredByUserId", "bankAccountId", "categoryId", "amount", "date", "description", "type", "createdAt"]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for expenses.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "name": { "type": "string" },
        "description": { "type": "string" }
      },
      "required": ["id", "userId", "name"]
    },
    "Payee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payee",
      "type": "object",
      "description": "Represents a payee for checks.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "name": { "type": "string" },
        "phoneNumber": { "type": "string" }
      },
      "required": ["id", "userId", "name"]
    },
    "Check": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Check",
      "type": "object",
      "description": "Represents a financial check.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "bankAccountId": { "type": "string" },
        "payeeId": { "type": "string" },
        "categoryId": { "type": "string" },
        "amount": { "type": "number" },
        "issueDate": { "type": "string", "format": "date-time" },
        "dueDate": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["pending", "cleared"] },
        "description": { "type": "string" }
      },
      "required": ["id", "userId", "bankAccountId", "payeeId", "categoryId", "amount", "issueDate", "dueDate", "status"]
    },
    "FinancialGoal": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "FinancialGoal",
        "type": "object",
        "description": "Represents a financial savings goal.",
        "properties": {
            "id": { "type": "string" },
            "userId": { "type": "string" },
            "name": { "type": "string" },
            "targetAmount": { "type": "number" },
            "currentAmount": { "type": "number" },
            "targetDate": { "type": "string", "format": "date-time" },
            "isAchieved": { "type": "boolean" },
            "priority": { "type": "string", "enum": ["low", "medium", "high"] },
            "savedFromBankAccountId": { "type": "string" },
            "savedAmount": { "type": "number" }
        },
        "required": ["id", "userId", "name", "targetAmount", "currentAmount", "targetDate", "isAchieved", "priority"]
    },
    "Loan": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Loan",
        "type": "object",
        "description": "Represents a loan.",
        "properties": {
            "id": { "type": "string" },
            "userId": { "type": "string" },
            "payeeId": { "type": "string" },
            "title": { "type": "string" },
            "amount": { "type": "number" },
            "installmentAmount": { "type": "number" },
            "remainingAmount": { "type": "number" },
            "startDate": { "type": "string", "format": "date-time" },
            "paymentDay": { "type": "number" },
            "numberOfInstallments": { "type": "number" },
            "paidInstallments": { "type": "number" }
        },
        "required": ["id", "userId", "title", "amount", "installmentAmount", "remainingAmount", "startDate", "paymentDay", "numberOfInstallments", "paidInstallments"]
    },
    "LoanPayment": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "LoanPayment",
        "type": "object",
        "description": "Represents a payment towards a loan.",
        "properties": {
            "id": { "type": "string" },
            "userId": { "type": "string" },
            "loanId": { "type": "string" },
            "bankAccountId": { "type": "string" },
            "amount": { "type": "number" },
            "paymentDate": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "userId", "loanId", "bankAccountId", "amount", "paymentDate"]
    },
    "Transfer": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Transfer",
        "type": "object",
        "description": "Represents an internal transfer between accounts.",
        "properties": {
            "id": { "type": "string" },
            "userId": { "type": "string", "description": "The user who initiated the transfer." },
            "fromBankAccountId": { "type": "string" },
            "toBankAccountId": { "type": "string" },
            "amount": { "type": "number" },
            "transferDate": { "type": "string", "format": "date-time" },
            "description": { "type": "string" }
        },
        "required": ["id", "userId", "fromBankAccountId", "toBankAccountId", "amount", "transferDate"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores user profiles."
        },
        "subcollections": [
            { "name": "bankAccounts", "schema": { "$ref": "#/entities/BankAccount" }, "description": "Personal bank accounts for the user." },
            { "name": "incomes", "schema": { "$ref": "#/entities/Income" }, "description": "Income records for the user." },
            { "name": "expenses", "schema": { "$ref": "#/entities/Expense" }, "description": "Expense records for the user." },
            { "name": "categories", "schema": { "$ref": "#/entities/Category" }, "description": "Personal expense categories for the user." },
            { "name": "payees", "schema": { "$ref": "#/entities/Payee" }, "description": "Personal payees for the user." },
            { "name": "checks", "schema": { "$ref": "#/entities/Check" }, "description": "Checks issued by the user." },
            { "name": "financialGoals", "schema": { "$ref": "#/entities/FinancialGoal" }, "description": "Financial goals for the user." },
            { "name": "loans", "schema": { "$ref": "#/entities/Loan" }, "description": "Loans taken by the user." },
            { "name": "loanPayments", "schema": { "$ref": "#/entities/LoanPayment" }, "description": "Payments made by the user for their loans." },
            { "name": "transfers", "schema": { "$ref": "#/entities/Transfer" }, "description": "Transfers initiated by the user." }
        ]
      },
      {
        "path": "/shared/data/bankAccounts/{accountId}",
        "definition": {
          "schema": { "$ref": "#/entities/BankAccount" },
          "description": "Shared bank accounts accessible by multiple users."
        }
      }
    ]
  }
}
