
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if the user is one of the two family members based on email.
    function isFamilyMember() {
      // The allowed emails for Ali and Fatemeh.
      let familyEmails = [
          'ali@khanevadati.app',
          'fatemeh@khanevadati.app'
      ];
      return request.auth != null && request.auth.token.email in familyEmails;
    }
    
    // Grant full read/write access to all collections and documents
    // for any authenticated family member.
    // This single rule covers /users/{userId}, all its subcollections,
    // and the /shared path.
    match /{path=**} {
      allow read, write: if isFamilyMember();
    }
  }
}
