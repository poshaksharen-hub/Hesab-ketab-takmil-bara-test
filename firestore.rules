
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    function isFamilyMember() {
      // The allowed emails for Ali and Fatemeh.
      let familyEmails = [
          'ali@khanevadati.app',
          'fatemeh@khanevadati.app'
      ];
      return request.auth != null && request.auth.token.email in familyEmails;
    }
    
    // Rule for user-specific data
    match /users/{userId}/{path=**} {
      allow read, write: if isFamilyMember();
    }

    // Explicit rule for the shared data collection
    match /shared/{path=**} {
       allow read, write: if isFamilyMember();
    }
  }
}
